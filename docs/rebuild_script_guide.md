# rebuild.sh è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ è„šæœ¬æ¦‚è¿°

`rebuild.sh` æ˜¯ä¸€ä¸ª**é‡æ–°æ„å»ºï¼ˆrebuildï¼‰è„šæœ¬**ï¼Œç”¨äºæ¸…ç†æ—§çš„æ„å»ºäº§ç‰©å¹¶é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ã€‚

**è„šæœ¬ä½ç½®**ï¼š
- `/mnt/c/AA/aae-master/common/aa/rebuild.sh`
- `/mnt/c/AA/aae-master/rebuild.sh`
- `/mnt/c/AA/aae-master/wsl_rebuild.sh`

---

## ğŸ“ è„šæœ¬æºç 

```bash
#!/bin/bash

set -e

# è®¾ç½®æ„å»ºç›®å½•
script_dir=$(dirname "$0")
build_dir="${script_dir}/build"

if [ -d "$build_dir" ]; then
	rm -r "$build_dir"
fi

${script_dir}/build.sh "$1"
```

---

## ğŸ” é€è¡Œè§£é‡Š

### ç¬¬ 1 è¡Œï¼šShebang
```bash
#!/bin/bash
```
**ä½œç”¨**ï¼šæŒ‡å®šä½¿ç”¨ `bash` è§£é‡Šå™¨æ‰§è¡Œæ­¤è„šæœ¬

---

### ç¬¬ 3 è¡Œï¼šé”™è¯¯å¤„ç†
```bash
set -e
```
**ä½œç”¨**ï¼šå¯ç”¨ä¸¥æ ¼æ¨¡å¼
- å¦‚æœä»»ä½•å‘½ä»¤å¤±è´¥ï¼ˆè¿”å›é0ï¼‰ï¼Œè„šæœ¬ç«‹å³é€€å‡º
- ç¡®ä¿æ„å»ºè¿‡ç¨‹ä¸­çš„é”™è¯¯ä¸ä¼šè¢«å¿½ç•¥
- é¿å…åœ¨é”™è¯¯çŠ¶æ€ä¸‹ç»§ç»­æ‰§è¡Œåç»­å‘½ä»¤

**ç¤ºä¾‹**ï¼š
```bash
# å¦‚æœ cmake å¤±è´¥ï¼Œè„šæœ¬ä¼šç«‹å³åœæ­¢ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œ make
cmake . && make
```

---

### ç¬¬ 6 è¡Œï¼šè·å–è„šæœ¬æ‰€åœ¨ç›®å½•
```bash
script_dir=$(dirname "$0")
```
**è¯¦ç»†è¯´æ˜**ï¼š
- `$0` = è„šæœ¬è‡ªèº«çš„è·¯å¾„ï¼ˆå¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼‰
- `dirname` = æå–è·¯å¾„çš„ç›®å½•éƒ¨åˆ†

**ç¤ºä¾‹**ï¼š
```bash
# å¦‚æœæ‰§è¡Œï¼š./common/aa/rebuild.sh
# åˆ™ $0 = ./common/aa/rebuild.sh
# dirname "$0" = ./common/aa
# script_dir = ./common/aa

# å¦‚æœæ‰§è¡Œï¼š/path/to/rebuild.sh
# script_dir = /path/to
```

---

### ç¬¬ 7 è¡Œï¼šè®¾ç½®æ„å»ºç›®å½•è·¯å¾„
```bash
build_dir="${script_dir}/build"
```
**ä½œç”¨**ï¼šæ„å»ºç›®å½• = è„šæœ¬ç›®å½•ä¸‹çš„ `build` æ–‡ä»¶å¤¹

**è·¯å¾„ç¤ºä¾‹**ï¼š
- å¦‚æœ `script_dir = /mnt/c/AA/aae-master/common/aa`
- åˆ™ `build_dir = /mnt/c/AA/aae-master/common/aa/build`

---

### ç¬¬ 9-11 è¡Œï¼šæ¸…ç†æ—§çš„æ„å»ºç›®å½•
```bash
if [ -d "$build_dir" ]; then
	rm -r "$build_dir"
fi
```
**è¯¦ç»†è¯´æ˜**ï¼š
- `[ -d "$build_dir" ]` = æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
- `rm -r` = é€’å½’åˆ é™¤ç›®å½•åŠå…¶æ‰€æœ‰å†…å®¹
- è¿™æ˜¯ **rebuild** çš„æ ¸å¿ƒï¼šå®Œå…¨æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©

**æ¸…ç†çš„å†…å®¹åŒ…æ‹¬**ï¼š
- CMake ç”Ÿæˆçš„ Makefile æˆ– Ninja æ–‡ä»¶
- æ‰€æœ‰ä¸­é—´ç›®æ ‡æ–‡ä»¶ï¼ˆ`.o`ã€`.obj`ï¼‰
- CMake ç¼“å­˜ï¼ˆ`CMakeCache.txt`ï¼‰
- æ‰€æœ‰æ„å»ºé…ç½®

---

### ç¬¬ 13 è¡Œï¼šè°ƒç”¨æ™®é€šæ„å»ºè„šæœ¬
```bash
${script_dir}/build.sh "$1"
```
**è¯¦ç»†è¯´æ˜**ï¼š
- è°ƒç”¨åŒç›®å½•ä¸‹çš„ `build.sh` è„šæœ¬è¿›è¡Œå®é™…æ„å»º
- `"$1"` = ä¼ é€’è„šæœ¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ„å»ºç±»å‹ï¼‰

**å‚æ•°ä¼ é€’ç¤ºä¾‹**ï¼š
```bash
# ç”¨æˆ·æ‰§è¡Œï¼š./rebuild.sh debug
# åˆ™ $1 = debug
# å®é™…è°ƒç”¨ï¼š./build.sh debug
```

---

## ğŸ¯ è„šæœ¬åŠŸèƒ½æµç¨‹å›¾

```
ç”¨æˆ·æ‰§è¡Œ rebuild.sh
    â†“
æ£€æŸ¥ build ç›®å½•æ˜¯å¦å­˜åœ¨
    â†“
å­˜åœ¨ â†’ åˆ é™¤æ•´ä¸ª build ç›®å½•
    â†“
è°ƒç”¨ build.sh é‡æ–°æ„å»º
    â†“
å®Œæˆ
```

---

## ğŸ“Š rebuild.sh vs build.sh

| ç‰¹æ€§ | build.sh | rebuild.sh |
|-----|----------|-----------|
| **æ„å»ºæ–¹å¼** | å¢é‡æ„å»º | å®Œå…¨é‡æ–°æ„å»º |
| **æ¸…ç†æ—§æ–‡ä»¶** | âŒ å¦ | âœ… æ˜¯ |
| **é€Ÿåº¦** | å¿«ï¼ˆåªç¼–è¯‘ä¿®æ”¹çš„æ–‡ä»¶ï¼‰ | æ…¢ï¼ˆç¼–è¯‘æ‰€æœ‰æ–‡ä»¶ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | æ—¥å¸¸å¼€å‘ | é…ç½®å˜æ›´ã€æ¸…ç†é—®é¢˜ |
| **CMake ç¼“å­˜** | ä¿ç•™ | æ¸…é™¤ |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
cd /mnt/c/AA/aae-master/common/aa

# é‡æ–°æ„å»º Debug ç‰ˆæœ¬
./rebuild.sh debug

# é‡æ–°æ„å»º Release ç‰ˆæœ¬
./rebuild.sh release
```

### é¡¹ç›®æ ¹ç›®å½•çš„ rebuild è„šæœ¬

```bash
cd /mnt/c/AA/aae-master

# WSL ç¯å¢ƒé‡æ–°æ„å»º
./wsl_rebuild.sh debug all

# Windows ç¯å¢ƒé‡æ–°æ„å»º
win_rebuild.bat debug all
```

---

## âš ï¸ ä½•æ—¶ä½¿ç”¨ rebuild.shï¼Ÿ

### âœ… å¿…é¡»ä½¿ç”¨ rebuild çš„æƒ…å†µ

1. **ä¿®æ”¹äº† CMakeLists.txt**
   - æ·»åŠ /åˆ é™¤æºæ–‡ä»¶
   - ä¿®æ”¹ç¼–è¯‘é€‰é¡¹
   - ä¿®æ”¹ä¾èµ–åº“é…ç½®

2. **åˆ‡æ¢æ„å»ºç±»å‹**
   - Debug â†” Release
   - ä¸åŒçš„ç¼–è¯‘å™¨è®¾ç½®

3. **æ„å»ºå‡ºç°å¥‡æ€ªé—®é¢˜**
   - é“¾æ¥é”™è¯¯ä½†ä»£ç æ²¡é—®é¢˜
   - CMake ç¼“å­˜æŸå
   - ä¾èµ–å…³ç³»æ··ä¹±

4. **æ·»åŠ /åˆ é™¤äº†æ–‡ä»¶**
   - æ–°å¢ `.cpp` æ–‡ä»¶
   - åˆ é™¤ `.h` å¤´æ–‡ä»¶

5. **æ›´æ–°äº†ç¬¬ä¸‰æ–¹åº“**
   - å‡çº§ Lua ç‰ˆæœ¬
   - æ›´æ–°å…¶ä»–ä¾èµ–

### âŒ ä¸éœ€è¦ rebuild çš„æƒ…å†µ

1. **åªä¿®æ”¹äº† .cpp/.h çš„å†…å®¹**
   - ç›´æ¥ç”¨ `build.sh` å³å¯
   - å¢é‡ç¼–è¯‘æ›´å¿«

2. **åªä¿®æ”¹äº† Lua è„šæœ¬**
   - ä¸éœ€è¦ä»»ä½•ç¼–è¯‘
   - ç›´æ¥è¿è¡Œå³å¯

---

## ğŸ’¡ å®ç”¨æŠ€å·§

### æŠ€å·§ 1ï¼šæ·»åŠ åˆ«åï¼ˆå¯é€‰ï¼‰

åœ¨ `~/.bashrc` ä¸­æ·»åŠ ï¼š
```bash
alias rb='./rebuild.sh debug'
alias rbd='./rebuild.sh debug'
alias rbr='./rebuild.sh release'
```

ä½¿ç”¨ï¼š
```bash
cd /mnt/c/AA/aae-master/common/aa
rb  # å¿«é€Ÿé‡æ–°æ„å»º debug ç‰ˆæœ¬
```

### æŠ€å·§ 2ï¼šæ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©

å¦‚æœæƒ³æ¸…ç†æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰æ„å»ºï¼š
```bash
cd /mnt/c/AA/aae-master
rm -rf build/
rm -rf common/aa/build/
./wsl_build.sh debug all
```

### æŠ€å·§ 3ï¼šæŸ¥çœ‹æ„å»ºæ—¶é—´

```bash
time ./rebuild.sh debug
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1ï¼šrebuild å’Œç›´æ¥åˆ é™¤ build ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**ï¼šåŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼`rebuild.sh` å°±æ˜¯è‡ªåŠ¨åŒ–äº†è¿™ä¸ªè¿‡ç¨‹ï¼š
```bash
# æ‰‹åŠ¨æ“ä½œ
rm -rf build/
./build.sh debug

# ä½¿ç”¨è„šæœ¬ï¼ˆä¸€è¡Œæå®šï¼‰
./rebuild.sh debug
```

### Q2ï¼šrebuild ä¼šåˆ é™¤ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶å—ï¼Ÿ

**A**ï¼šä¸ä¼šï¼å¯æ‰§è¡Œæ–‡ä»¶åœ¨ `lib/` ç›®å½•ï¼Œrebuild åªåˆ é™¤ `build/` ç›®å½•ï¼ˆä¸­é—´æ–‡ä»¶ï¼‰ã€‚

### Q3ï¼šä¸ºä»€ä¹ˆæœ‰æ—¶å€™ build.sh ä¸è¡Œï¼Œå¿…é¡»ç”¨ rebuild.shï¼Ÿ

**A**ï¼šå› ä¸º CMake ä¼šç¼“å­˜é…ç½®ã€‚å½“ä½ ä¿®æ”¹äº†ï¼š
- CMakeLists.txt
- ç¼–è¯‘é€‰é¡¹
- ä¾èµ–åº“è·¯å¾„

CMake å¯èƒ½ä½¿ç”¨æ—§çš„ç¼“å­˜ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚rebuild ä¼šæ¸…é™¤è¿™äº›ç¼“å­˜ã€‚

---

## ğŸ“š ç›¸å…³è„šæœ¬

| è„šæœ¬ | ä½ç½® | åŠŸèƒ½ |
|-----|------|------|
| `build.sh` | `common/aa/` | å¢é‡æ„å»º |
| `rebuild.sh` | `common/aa/` | å®Œå…¨é‡æ–°æ„å»º |
| `wsl_build.sh` | é¡¹ç›®æ ¹ç›®å½• | WSL ç¯å¢ƒæ„å»º |
| `wsl_rebuild.sh` | é¡¹ç›®æ ¹ç›®å½• | WSL ç¯å¢ƒé‡æ–°æ„å»º |
| `win_build.bat` | é¡¹ç›®æ ¹ç›®å½• | Windows ç¯å¢ƒæ„å»º |
| `win_rebuild.bat` | é¡¹ç›®æ ¹ç›®å½• | Windows ç¯å¢ƒé‡æ–°æ„å»º |

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æ„å»ºç›®å½•ä½ç½®

å¦‚æœæƒ³ä¿®æ”¹æ„å»ºç›®å½•ä½ç½®ï¼Œå¯ä»¥ç¼–è¾‘è„šæœ¬ï¼š
```bash
# åŸæ¥ï¼š
build_dir="${script_dir}/build"

# æ”¹ä¸ºè‡ªå®šä¹‰ä½ç½®ï¼š
build_dir="/tmp/my_build"
```

### æ·»åŠ æ„å»ºå‰çš„è‡ªå®šä¹‰æ“ä½œ

```bash
#!/bin/bash
set -e

script_dir=$(dirname "$0")
build_dir="${script_dir}/build"

# æ·»åŠ è‡ªå®šä¹‰æ“ä½œ
echo "å¼€å§‹æ¸…ç†å’Œé‡æ–°æ„å»º..."
date

if [ -d "$build_dir" ]; then
	echo "åˆ é™¤æ—§çš„æ„å»ºç›®å½•: $build_dir"
	rm -r "$build_dir"
fi

# å¯ä»¥æ·»åŠ å…¶ä»–æ¸…ç†æ“ä½œ
# rm -f *.log

${script_dir}/build.sh "$1"

echo "æ„å»ºå®Œæˆï¼"
```

---

## âœ… æ€»ç»“

`rebuild.sh` æ˜¯ä¸€ä¸ªç®€å•ä½†å®ç”¨çš„è„šæœ¬ï¼š
1. **æ¸…ç†**ï¼šåˆ é™¤ `build/` ç›®å½•
2. **æ„å»º**ï¼šè°ƒç”¨ `build.sh` é‡æ–°ç¼–è¯‘

**æ ¸å¿ƒä»·å€¼**ï¼šç¡®ä¿å¹²å‡€çš„æ„å»ºç¯å¢ƒï¼Œé¿å…ç¼“å­˜é—®é¢˜ã€‚

**è®°ä½**ï¼š
- ğŸŸ¢ æ—¥å¸¸å¼€å‘ç”¨ `build.sh`ï¼ˆå¿«ï¼‰
- ğŸ”´ é‡åˆ°é—®é¢˜ç”¨ `rebuild.sh`ï¼ˆå½»åº•ï¼‰

